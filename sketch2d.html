<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no, viewport-fit=cover" />
  <title>Sketcher 2D</title>
  <link rel="stylesheet" href="./css/styles.css" />
  <style>
    /* 2D toolbar tweaks */
  /* Match 3D toolbox layout; only ensure it shows on the 2D page */
  #toolbox { display: block !important; }
  /* Keep 2D page basics only; detailed toolbox styles come from styles.css */
    #statusBar { position: fixed; left: 24px; bottom: 18px; background: rgba(255,255,255,0.95); border-radius: 10px; padding: 6px 10px; font: 12px/1.2 system-ui, sans-serif; color: #333; box-shadow: 0 2px 10px rgba(0,0,0,.08); }
    body { background: #fafafa; }
    #grid2d { position: fixed; inset: 0; z-index: 0; }
  /* Slightly smaller buttons inside Erase panel */
  #erase2DGroup .icon-btn { width: 32px; height: 32px; min-width: 32px; min-height: 32px; }
  /* Import modal mobile ergonomics */
  #importScaleModal .icon-btn { width: 36px; height: 36px; min-width: 36px; min-height: 36px; }
  #importScaleModal .btn { font: 14px/1.2 system-ui, sans-serif; }
  #importScaleModal select, #importScaleModal input[type="number"], #importScaleModal input[type="range"] { font-size: 14px; }
  #importPageThumbs { -webkit-overflow-scrolling: touch; }
  @media (max-width: 720px){
    #importModalBody { flex-direction: column !important; }
    #importPreviewContainer { min-height: 40vh; }
    #importScaleModal .icon-btn { width: 40px; height: 40px; min-width: 40px; min-height: 40px; }
  }
  </style>
  <style>
    /* Temp snip edit theme accents */
    body.snip-edit-mode #statusBar { background: rgba(30,136,229,0.1); color:#0b3a6e; border:1px solid rgba(30,136,229,0.3); }
    body.snip-edit-mode #toolbox .toggle-btn[aria-pressed="true"],
    body.snip-edit-mode .icon-btn[aria-pressed="true"] { outline: 2px solid #1e88e5; }
  </style>
</head>
<body>
  <div id="pageFade"></div>
  <canvas id="grid2d"></canvas>
  <!-- Temp Snip Edit bar (only in snip-edit-mode) -->
  <div id="snipEdit2DBar" role="group" aria-label="Snip edit" style="display:none; position:fixed; left:24px; top:12px; background:rgba(255,255,255,0.96); border:1px solid #e0e0e0; border-radius:12px; box-shadow:0 2px 12px rgba(0,0,0,0.10); padding:6px; z-index:120; gap:6px; align-items:center;">
    <span id="snipEdit2DLabel" style="font:600 12px/1.2 system-ui, sans-serif; color:#0b3a6e; letter-spacing:.06em; text-transform:uppercase;">Editing Snip</span>
    <button id="snipEdit2DFinish" class="icon-btn" title="Finish and return" aria-label="Finish and return" type="button" style="width:36px; height:36px; min-width:36px; min-height:36px; border-radius:10px;">
      <svg viewBox="0 0 24 24" aria-hidden="true"><path d="M9 16.2 4.8 12l-1.4 1.4L9 19 21 7l-1.4-1.4z" fill="#222"/></svg>
    </button>
    <button id="snipEdit2DCancel" class="icon-btn" title="Cancel" aria-label="Cancel" type="button" style="width:36px; height:36px; min-width:36px; min-height:36px; border-radius:10px;">
      <svg viewBox="0 0 24 24" aria-hidden="true"><path d="M18.3 5.71 12 12.01 5.7 5.7 4.29 7.11 10.59 13.4 4.3 19.7 5.71 21.11 12 14.82 18.29 21.1 19.7 19.69 13.41 13.4 19.71 7.1z" fill="#222"/></svg>
    </button>
  </div>
  <div id="toolbox">
    <!-- Object Select toggle (affects left-click). Middle-click always pans. -->
    <button id="toggle2DSelect" class="icon-btn toggle-btn" title="Object Select (V)" aria-label="Object Select" aria-pressed="false">
      <span class="sr-only">Object Select</span>
      <svg viewBox="-0.5 -0.5 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" id="Cursor-Pointer--Streamline-Iconoir" height="16" width="16">
        <path fill-rule="evenodd" clip-rule="evenodd" d="M13.2403125 5.168374999999999c0.9875625 0.401125 0.9121875 1.82375 -0.11225 2.1181875l-5.1691875 1.4859375 -2.3609375 4.8326875000000005c-0.4679375 0.9576875 -1.8820625 0.784875 -2.1055625 -0.25725000000000003L1.0856875000000001 2.1243125c-0.18887500000000002 -0.8808125 0.6848124999999999 -1.6139375 1.5195 -1.275l10.635125 4.3190625Z" stroke="#000000" stroke-width="1"></path>
      </svg>
    </button>
    <!-- Drawing parent (freehand) -->
    <button id="toggle2DDraw" class="icon-btn toggle-btn" title="Drawing" aria-label="Drawing" aria-pressed="false">
      <span class="sr-only">Drawing</span>
      <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" id="Pencil-Sketch--Streamline-Ultimate" height="24" width="24">
        <path stroke="#000000" stroke-linecap="round" stroke-linejoin="round" d="m3.50292 23.25 0 -10.4464L8.5 15.5 12 13l3.5 2.5 4.9961 -2.6964 0 10.4464" stroke-width="1.5"></path>
        <path stroke="#000000" stroke-linecap="round" stroke-linejoin="round" d="M3.51253 12.8022 11.1868 1.91037c0.3984 -0.56536 1.2366 -0.56536 1.635 0l7.6743 10.89183" stroke-width="1.5"></path>
        <path stroke="#000000" stroke-linecap="round" stroke-linejoin="round" d="m8.5 15.5 0 7.75" stroke-width="1.5"></path>
        <path stroke="#000000" stroke-linecap="round" stroke-linejoin="round" d="m15.5 15.5 0 7.75" stroke-width="1.5"></path>
        <path stroke="#000000" stroke-linecap="round" stroke-linejoin="round" d="m7.60156 7 8.79684 0" stroke-width="1.5"></path>
      </svg>
    </button>
    <div id="draw2DGroup" class="collapse" aria-hidden="true">
      <button id="tPen" class="icon-btn" aria-pressed="false" title="Freehand (P)" aria-label="Pen">
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" id="Pen-Draw-1--Streamline-Ultimate" height="24" width="24">
          <path stroke="#000000" stroke-linecap="round" stroke-linejoin="round" d="M1.07129 14.3347C10.6335 4.43099 14.5183 0.545282 16.7806 3.06492c1.3661 1.52153 -2.0489 5.63496 -5.464 9.47688 -3.41512 3.842 -4.70215 6.4321 -3.09903 7.3997 1.88573 1.1381 5.45783 -2.4888 6.86943 -3.9062 1.6936 -1.7006 3.9054 -4.84 5.3649 -2.9812s-3.6712 5.9764 -2.3052 8.0255c1.0929 1.6392 3.6428 -0.4554 4.7812 -1.7076" stroke-width="1.5"></path>
        </svg>
      </button>
      <button id="tSmart" class="icon-btn" aria-pressed="false" title="Smart Draw" aria-label="Smart Draw">
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" id="Draw-Abstract--Streamline-Outlined-Material" height="24" width="24">
          <path fill="#000000" d="M3.55 20.525c-0.083335 0.08335 -0.170835 0.14165 -0.2625 0.175 -0.091665 0.03335 -0.1875 0.05 -0.2875 0.05 -0.1 0 -0.191665 -0.01665 -0.275 -0.05 -0.083335 -0.03335 -0.166665 -0.09165 -0.25 -0.175 -0.15 -0.13335 -0.225 -0.30415 -0.225 -0.5125 0 -0.20835 0.066665 -0.3875 0.2 -0.5375 0.283335 -0.28335 0.629165 -0.45415 1.0375 -0.5125 0.408335 -0.05835 0.8125 -0.05415 1.2125 0.0125 0.183335 0.03335 0.35 0.0625 0.5 0.0875 0.15 0.025 0.28335 -0.02085 0.4 -0.1375 0.13335 -0.13335 0.19165 -0.29165 0.175 -0.475 -0.01665 -0.18335 -0.04165 -0.36665 -0.075 -0.55 -0.06665 -0.4 -0.07915 -0.80415 -0.0375 -1.2125 0.04165 -0.40835 0.20415 -0.7625 0.4875 -1.0625 0.28335 -0.28335 0.62915 -0.45415 1.0375 -0.5125 0.40835 -0.05835 0.8125 -0.05415 1.2125 0.0125 0.18335 0.03335 0.35415 0.0625 0.5125 0.0875 0.15835 0.025 0.29585 -0.02085 0.4125 -0.1375 0.13335 -0.13335 0.1875 -0.29165 0.1625 -0.475 -0.025 -0.18335 -0.05415 -0.36665 -0.0875 -0.55 -0.06665 -0.4 -0.07915 -0.80415 -0.0375 -1.2125 0.04165 -0.40835 0.20415 -0.7625 0.4875 -1.0625 0.28335 -0.28335 0.62915 -0.45415 1.0375 -0.5125 0.40835 -0.05835 0.8125 -0.05415 1.2125 0.0125 0.18335 0.03335 0.35415 0.0625 0.5125 0.0875 0.15835 0.025 0.29585 -0.02085 0.4125 -0.1375 0.13335 -0.13335 0.1875 -0.29165 0.1625 -0.475 -0.025 -0.18335 -0.05415 -0.36665 -0.0875 -0.55 -0.06665 -0.41665 -0.075 -0.825 -0.025 -1.225 0.05 -0.4 0.21665 -0.75 0.5 -1.05 0.28335 -0.28335 0.62915 -0.45415 1.0375 -0.5125 0.40835 -0.05835 0.8125 -0.05415 1.2125 0.0125 0.18335 0.03335 0.35415 0.0625 0.5125 0.0875 0.15835 0.025 0.29585 -0.02085 0.4125 -0.1375 0.13335 -0.13335 0.1875 -0.29165 0.1625 -0.475 -0.025 -0.18335 -0.05415 -0.36665 -0.0875 -0.55 -0.06665 -0.41665 -0.075 -0.825 -0.025 -1.225 0.05 -0.4 0.21665 -0.75 0.5 -1.05 0.28335 -0.3 0.62915 -0.475 1.0375 -0.525 0.40835 -0.05 0.8125 -0.041665 1.2125 0.025 0.18335 0.033335 0.35 0.0625 0.5 0.0875 0.15 0.025 0.29165 -0.029165 0.425 -0.1625 0.13335 -0.15 0.30415 -0.225 0.5125 -0.225 0.20835 0 0.3875 0.066665 0.5375 0.2 0.15 0.133335 0.225 0.304165 0.225 0.5125 0 0.208335 -0.06665 0.3875 -0.2 0.5375 -0.28335 0.3 -0.62915 0.47915 -1.0375 0.5375 -0.40835 0.05835 -0.8125 0.05415 -1.2125 -0.0125 -0.18335 -0.03335 -0.35415 -0.0625 -0.5125 -0.0875 -0.15835 -0.025 -0.29585 0.020835 -0.4125 0.1375 -0.13335 0.13335 -0.1875 0.29165 -0.1625 0.475 0.025 0.18335 0.05415 0.36665 0.0875 0.55 0.06665 0.41665 0.075 0.825 0.025 1.225 -0.05 0.4 -0.21665 0.75 -0.5 1.05 -0.28335 0.28335 -0.62915 0.45415 -1.0375 0.5125 -0.40835 0.05835 -0.8125 0.05415 -1.2125 -0.0125 -0.18335 -0.03335 -0.35 -0.0625 -0.5 -0.0875 -0.15 -0.025 -0.28335 0.02085 -0.4 0.1375 -0.13335 0.13335 -0.19165 0.29165 -0.175 0.475 0.01665 0.18335 0.04165 0.36665 0.075 0.55 0.06665 0.4 0.07915 0.80415 0.0375 1.2125 -0.04165 0.40835 -0.20415 0.7625 -0.4875 1.0625 -0.28335 0.28335 -0.62915 0.45415 -1.0375 0.5125 -0.40835 0.05835 -0.8125 0.05415 -1.2125 -0.0125 -0.18335 -0.03335 -0.35 -0.05835 -0.5 -0.075 -0.15 -0.01665 -0.28335 0.03335 -0.4 0.15 -0.13335 0.13335 -0.19165 0.2875 -0.175 0.4625 0.01665 0.175 0.04165 0.35415 0.075 0.5375 0.06665 0.4 0.07915 0.80415 0.0375 1.2125 -0.04165 0.40835 -0.20415 0.7625 -0.4875 1.0625 -0.28335 0.3 -0.63335 0.475 -1.05 0.525 -0.41665 0.05 -0.825 0.04165 -1.225 -0.025 -0.18335 -0.03335 -0.35 -0.05835 -0.5 -0.075 -0.15 -0.01665 -0.28335 0.03335 -0.4 0.15 -0.13335 0.13335 -0.1875 0.2875 -0.1625 0.4625 0.025 0.175 0.05415 0.35415 0.0875 0.5375 0.06665 0.41665 0.075 0.825 0.025 1.225 -0.05 0.4 -0.21665 0.75 -0.5 1.05 -0.28335 0.28335 -0.62915 0.45415 -1.0375 0.5125 -0.40835 0.05835 -0.8125 0.05415 -1.2125 -0.0125 -0.183335 -0.03335 -0.35 -0.05835 -0.5 -0.075 -0.15 -0.01665 -0.283335 0.03335 -0.4 0.15ZM6 11c-1.383335 0 -2.5625 -0.4875 -3.5375 -1.4625C1.4875 8.5625 1 7.38335 1 6c0 -1.4 0.4875 -2.583335 1.4625 -3.55C3.4375 1.483335 4.616665 1 6 1c1.4 0 2.58335 0.483335 3.55 1.45C10.51665 3.416665 11 4.6 11 6c0 1.38335 -0.48335 2.5625 -1.45 3.5375C8.58335 10.5125 7.4 11 6 11Zm0 -1.5c0.98335 0 1.8125 -0.34165 2.4875 -1.025C9.1625 7.79165 9.5 6.96665 9.5 6c0 -0.98335 -0.3375 -1.8125 -1.0125 -2.4875C7.8125 2.8375 6.98335 2.5 6 2.5c-0.96665 0 -1.791665 0.3375 -2.475 1.0125C2.841665 4.1875 2.5 5.01665 2.5 6c0 0.96665 0.341665 1.79165 1.025 2.475C4.208335 9.15835 5.03335 9.5 6 9.5Zm9.5 13.5c-0.41665 0 -0.77085 -0.14585 -1.0625 -0.4375C14.14585 22.27085 14 21.91665 14 21.5V15.5c0 -0.41665 0.14585 -0.77085 0.4375 -1.0625C14.72915 14.14585 15.08335 14 15.5 14h6c0.41665 0 0.77085 0.14585 1.0625 0.4375 0.29165 0.29165 0.4375 0.64585 0.4375 1.0625v6c0 0.41665 -0.14585 0.77085 -0.4375 1.0625 -0.29165 0.29165 -0.64585 0.4375 -1.0625 0.4375H15.5Zm0 -1.5h6V15.5H15.5v6Z" stroke-width="1"></path>
        </svg>
      </button>
    </div>

    <!-- Modify parent (offset/fillet/chamfer/trim/mirror/array/dimension/measure/hatch) -->
    <button id="toggle2DModify" class="icon-btn toggle-btn" title="Modify" aria-label="Modify" aria-pressed="false">
      <span class="sr-only">Modify</span>
      <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 14 14" id="Ai-Edit-Spark--Streamline-Core" height="14" width="14">
  <desc>
    Ai Edit Spark Streamline Icon: https://streamlinehq.com
  </desc>
  <g id="modify">
    <path id="Vector" stroke="#000000" stroke-linecap="round" stroke-linejoin="round" d="m6.92572 13.2018 -3 0.26 0.26 -3 6.23998 -6.19999c0.0932 -0.09524 0.2044 -0.17092 0.3272 -0.22259 0.1227 -0.05167 0.2546 -0.07828 0.3878 -0.07828 0.1332 0 0.2651 0.02661 0.3879 0.07828 0.1228 0.05167 0.234 0.12735 0.3271 0.22259l1.27 1.28c0.0937 0.09297 0.1681 0.20357 0.2189 0.32543 0.0508 0.12186 0.0769 0.25256 0.0769 0.38457 0 0.13201 -0.0261 0.26272 -0.0769 0.38458 -0.0508 0.12186 -0.1252 0.23246 -0.2189 0.32542L6.92572 13.2018Z" stroke-width="1"></path>
    <path id="Vector 2136" stroke="#000000" stroke-linecap="round" stroke-linejoin="round" d="M0.841689 3.97204c-0.35093 -0.06106 -0.35093 -0.56483 -0.000001 -0.62588C2.11305 3.12497 3.12423 2.15661 3.40019 0.896007l0.02115 -0.096629c0.07592 -0.346833 0.56977 -0.348992 0.64872 -0.002836l0.02568 0.11261C4.38191 2.16381 5.39337 3.12399 6.6612 3.34456c0.35272 0.06136 0.35272 0.56771 0 0.62907 -1.26783 0.22057 -2.27929 1.18075 -2.56546 2.43541l-0.02568 0.11261c-0.07895 0.34616 -0.5728 0.344 -0.64872 -0.00284l-0.02115 -0.09662C3.12423 5.16158 2.11305 4.19322 0.841689 3.97204Z" stroke-width="1"></path>
  </g>
      </svg>
    </button>
    <div id="modify2DGroup" class="collapse" aria-hidden="true">
      <button id="tOffset" class="icon-btn" aria-pressed="false" title="Offset" aria-label="Offset">
        <svg viewBox="0 0 24 24" aria-hidden="true">
          <path d="M5 18 L12 11 L19 18" fill="none" stroke="#222" stroke-width="2"/>
          <path d="M7 20 L12 15 L17 20" fill="none" stroke="#222" stroke-width="1.5" opacity=".8"/>
        </svg>
      </button>
      <button id="tFillet" class="icon-btn" aria-pressed="false" title="Fillet" aria-label="Fillet">
        <svg viewBox="0 0 24 24" aria-hidden="true">
          <path d="M5 19 L5 9 L15 9" fill="none" stroke="#222" stroke-width="2"/>
          <path d="M5 9 A4 4 0 0 0 9 13" fill="none" stroke="#222" stroke-width="2"/>
        </svg>
      </button>
      <button id="tChamfer" class="icon-btn" aria-pressed="false" title="Chamfer" aria-label="Chamfer">
        <svg viewBox="0 0 24 24" aria-hidden="true">
          <path d="M5 19 L5 9 L15 9" fill="none" stroke="#222" stroke-width="2"/>
          <path d="M5 9 L9 13" fill="none" stroke="#222" stroke-width="2"/>
        </svg>
      </button>
      <button id="tTrim" class="icon-btn" aria-pressed="false" title="Trim/Extend" aria-label="Trim/Extend">
        <svg viewBox="0 0 24 24" aria-hidden="true">
          <path d="M5 7 L19 7" stroke="#222" stroke-width="2"/>
          <path d="M9 17 L15 11" stroke="#222" stroke-width="2"/>
          <path d="M15 11 L19 7" stroke="#222" stroke-width="2" opacity=".4"/>
        </svg>
      </button>
      <button id="tMirror" class="icon-btn" aria-pressed="false" title="Mirror" aria-label="Mirror">
        <svg viewBox="0 0 24 24" aria-hidden="true">
          <path d="M12 4 L12 20" stroke="#222" stroke-width="2"/>
          <path d="M6 8 L10 12 L6 16" fill="none" stroke="#222" stroke-width="2"/>
          <path d="M18 8 L14 12 L18 16" fill="none" stroke="#222" stroke-width="2"/>
        </svg>
      </button>
      <button id="tArray" class="icon-btn" aria-pressed="false" title="Array" aria-label="Array">
        <svg viewBox="0 0 24 24" aria-hidden="true">
          <rect x="4" y="6" width="4" height="4" fill="none" stroke="#222" stroke-width="2"/>
          <rect x="10" y="6" width="4" height="4" fill="none" stroke="#222" stroke-width="2"/>
          <rect x="16" y="6" width="4" height="4" fill="none" stroke="#222" stroke-width="2"/>
        </svg>
      </button>
      <button id="tDimension" class="icon-btn" aria-pressed="false" title="Dimension" aria-label="Dimension">
        <svg viewBox="0 0 24 24" aria-hidden="true">
          <path d="M6 16 L18 8" stroke="#222" stroke-width="2"/>
          <path d="M7 17 L5 15 M19 9 L17 7" stroke="#222" stroke-width="2"/>
          <text x="12" y="12" font-size="3" text-anchor="middle" fill="#222">↔</text>
        </svg>
      </button>
      <button id="tMeasure" class="icon-btn" aria-pressed="false" title="Measure" aria-label="Measure">
        <svg viewBox="0 0 24 24" aria-hidden="true">
          <path d="M5 18 L19 6" stroke="#222" stroke-width="2"/>
          <circle cx="5" cy="18" r="1.2" fill="#222"/>
          <circle cx="19" cy="6" r="1.2" fill="#222"/>
        </svg>
      </button>
      <button id="tHatch" class="icon-btn" aria-pressed="false" title="Hatch" aria-label="Hatch">
        <svg viewBox="0 0 24 24" aria-hidden="true">
          <rect x="5" y="5" width="14" height="14" fill="none" stroke="#222" stroke-width="2"/>
          <path d="M7 17 L17 7 M9 19 L19 9 M5 15 L15 5" stroke="#222" stroke-width="1.5"/>
        </svg>
      </button>
    </div>
    <!-- Shapes parent (line/rect/ellipse) -->
    <button id="toggle2DShapes" class="icon-btn toggle-btn" title="Shapes" aria-label="Shapes" aria-pressed="false">
      <span class="sr-only">Shapes</span>
      <svg viewBox="0 0 24 24" aria-hidden="true">
        <!-- Square bottom-left -->
        <rect x="3" y="13" width="7" height="7" fill="none" stroke="#222" stroke-width="2"/>
        <!-- Circle top-right (nudged up-right and slightly smaller) -->
        <circle cx="19" cy="6" r="3" fill="none" stroke="#222" stroke-width="2"/>
        <!-- Triangle mid-right (shifted left/down to avoid touching the circle) -->
        <path d="M12.5 17 L17.5 17 L15 11 Z" fill="none" stroke="#222" stroke-width="2"/>
      </svg>
    </button>
    <div id="shapes2DGroup" class="collapse" aria-hidden="true">
      <button id="tLine" class="icon-btn" aria-pressed="false" title="Line (L)" aria-label="Line">
        <svg viewBox="0 0 24 24" aria-hidden="true">
          <path d="M5 19L19 5" stroke="#222" stroke-width="2"/>
          <circle cx="5" cy="19" r="1.5" fill="#222"/>
          <circle cx="19" cy="5" r="1.5" fill="#222"/>
        </svg>
      </button>
      <button id="tPolyline" class="icon-btn" aria-pressed="false" title="Polyline (Y)" aria-label="Polyline">
        <svg viewBox="0 0 24 24" aria-hidden="true">
          <polyline points="4,16 9,11 13,15 20,8" fill="none" stroke="#222" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
          <circle cx="4" cy="16" r="1.3" fill="#222"/>
          <circle cx="9" cy="11" r="1.3" fill="#222"/>
          <circle cx="13" cy="15" r="1.3" fill="#222"/>
          <circle cx="20" cy="8" r="1.3" fill="#222"/>
        </svg>
      </button>
      <button id="tRect" class="icon-btn" aria-pressed="false" title="Rectangle (R)" aria-label="Rect">
        <svg viewBox="0 0 24 24" aria-hidden="true"><rect x="5" y="5" width="14" height="14" fill="none" stroke="#222" stroke-width="2"/></svg>
      </button>
      <button id="tEllipse" class="icon-btn" aria-pressed="false" title="Ellipse (O)" aria-label="Ellipse">
        <svg viewBox="0 0 24 24" aria-hidden="true"><ellipse cx="12" cy="12" rx="7" ry="5" fill="none" stroke="#222" stroke-width="2"/></svg>
      </button>
      <button id="tPolygon" class="icon-btn" aria-pressed="false" title="Polygon (G)" aria-label="Polygon">
        <svg viewBox="0 0 24 24" aria-hidden="true">
          <polygon points="6,5 18,7 20,18 10,20 4,12" fill="none" stroke="#222" stroke-width="2"/>
        </svg>
      </button>
      <button id="tRegPoly" class="icon-btn" aria-pressed="false" title="Regular Polygon (N)" aria-label="Regular Polygon">
        <svg viewBox="0 0 24 24" aria-hidden="true">
          <polygon points="12,4 18,8 16,16 8,16 6,8" fill="none" stroke="#222" stroke-width="2"/>
        </svg>
      </button>
      <button id="tRoundRect" class="icon-btn" aria-pressed="false" title="Rounded Rect (U)" aria-label="Rounded Rect">
        <svg viewBox="0 0 24 24" aria-hidden="true">
          <rect x="5" y="6" width="14" height="12" rx="3" ry="3" fill="none" stroke="#222" stroke-width="2"/>
        </svg>
      </button>
      <button id="tStar" class="icon-btn" aria-pressed="false" title="Star" aria-label="Star">
        <svg viewBox="0 0 24 24" aria-hidden="true">
          <path d="M12 4l2.5 4.9 5.5.8-4 3.9.9 5.5L12 16.8 7.1 19l.9-5.5-4-3.9 5.5-.8L12 4z" fill="none" stroke="#222" stroke-width="2"/>
        </svg>
      </button>
      <button id="tArc3" class="icon-btn" aria-pressed="false" title="Arc 3-Point (A)" aria-label="Arc 3-Point">
        <svg viewBox="0 0 24 24" aria-hidden="true">
          <path d="M5 16a8 8 0 0 1 14-4" fill="none" stroke="#222" stroke-width="2" stroke-linecap="round"/>
          <circle cx="5" cy="16" r="1.2" fill="#222"/>
          <circle cx="12" cy="8" r="1.2" fill="#222"/>
          <circle cx="19" cy="12" r="1.2" fill="#222"/>
        </svg>
      </button>
      <button id="tArcCenter" class="icon-btn" aria-pressed="false" title="Arc Center" aria-label="Arc Center">
        <svg viewBox="0 0 24 24" aria-hidden="true">
          <circle cx="9" cy="12" r="1.2" fill="#222"/>
          <path d="M9 12 A6 6 0 0 1 19 10" fill="none" stroke="#222" stroke-width="2" stroke-linecap="round"/>
        </svg>
      </button>
      <button id="tBezier" class="icon-btn" aria-pressed="false" title="Bezier (C)" aria-label="Bezier">
        <svg viewBox="0 0 24 24" aria-hidden="true">
          <path d="M5 16 C8 8, 16 8, 19 16" fill="none" stroke="#222" stroke-width="2"/>
          <circle cx="5" cy="16" r="1.2" fill="#222"/>
          <circle cx="12" cy="10" r="1.2" fill="#222"/>
          <circle cx="19" cy="16" r="1.2" fill="#222"/>
        </svg>
      </button>
    </div>

    <!-- Text parent -->
    <button id="toggle2DText" class="icon-btn toggle-btn" title="Text" aria-label="Text" aria-pressed="false">
      <span class="sr-only">Text</span>
      <svg viewBox="0 0 24 24" aria-hidden="true">
        <path d="M4 6h16" stroke="#222" stroke-width="2.2" stroke-linecap="round"/>
        <path d="M12 6v12" stroke="#222" stroke-width="2.2" stroke-linecap="round"/>
      </svg>
    </button>
    <div id="text2DGroup" class="collapse" aria-hidden="true">
      <button id="tText" class="icon-btn" aria-pressed="false" title="Text (T)" aria-label="Text">
        <svg viewBox="0 0 24 24" aria-hidden="true">
          <path d="M5 6h14" stroke="#222" stroke-width="2.2" stroke-linecap="round"/>
          <path d="M12 6v12" stroke="#222" stroke-width="2.2" stroke-linecap="round"/>
        </svg>
      </button>
    </div>

  <!-- Style parent -->
    <button id="toggle2DStyle" class="icon-btn toggle-btn" title="Style" aria-label="Style" aria-pressed="false">
      <span class="sr-only">Style</span>
      <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" id="Palette" height="24" width="24">
        <path fill="#000000" d="M12 22c-1.36665 0 -2.65835 -0.2625 -3.875 -0.7875 -1.21665 -0.525 -2.27915 -1.24165 -3.1875 -2.15 -0.908335 -0.90835 -1.625 -1.97085 -2.15 -3.1875C2.2625 14.65835 2 13.36665 2 12c0 -1.41665 0.266665 -2.73335 0.8 -3.95 0.533335 -1.21665 1.2625 -2.275 2.1875 -3.175 0.925 -0.9 2.00835 -1.604165 3.25 -2.1125C9.47915 2.254165 10.80835 2 12.225 2c1.31665 0 2.56665 0.220835 3.75 0.6625S18.19585 3.716665 19.0875 4.5c0.89165 0.78335 1.6 1.7125 2.125 2.7875C21.7375 8.3625 22 9.54165 22 10.825c0 1.8 -0.525 3.22085 -1.575 4.2625 -1.05 1.04165 -2.44165 1.5625 -4.175 1.5625h-1.875c-0.3 0 -0.55835 0.11665 -0.775 0.35 -0.21665 0.23335 -0.325 0.49165 -0.325 0.775 0 0.45 0.12085 0.83335 0.3625 1.15 0.24165 0.31665 0.3625 0.68335 0.3625 1.1 0 0.63335 -0.175 1.12085 -0.525 1.4625C13.125 21.82915 12.63335 22 12 22ZM6.175 12.65c0.33335 0 0.625 -0.125 0.875 -0.375s0.375 -0.54165 0.375 -0.875c0 -0.33335 -0.125 -0.625 -0.375 -0.875s-0.54165 -0.375 -0.875 -0.375c-0.33335 0 -0.625 0.125 -0.875 0.375s-0.375 0.54165 -0.375 0.875c0 0.33335 0.125 0.625 0.375 0.875s0.54165 0.375 0.875 0.375Zm3.15 -4.25c0.33335 0 0.625 -0.125 0.875 -0.375s0.375 -0.54165 0.375 -0.875c0 -0.33335 -0.125 -0.625 -0.375 -0.875s-0.54165 -0.375 -0.875 -0.375c-0.33335 0 -0.625 0.125 -0.875 0.375s-0.375 0.54165 -0.375 0.875c0 0.33335 0.125 0.625 0.375 0.875s0.54165 0.375 0.875 0.375Zm5.35 0c0.33335 0 0.625 -0.125 0.875 -0.375s0.375 -0.54165 0.375 -0.875c0 -0.33335 -0.125 -0.625 -0.375 -0.875s-0.54165 -0.375 -0.875 -0.375c-0.33335 0 -0.625 0.125 -0.875 0.375s-0.375 0.54165 -0.375 0.875c0 0.33335 0.125 0.625 0.375 0.875s0.54165 0.375 0.875 0.375Zm3.275 4.25c0.33335 0 0.625 -0.125 0.875 -0.375s0.375 -0.54165 0.375 -0.875c0 -0.33335 -0.125 -0.625 -0.375 -0.875s-0.54165 -0.375 -0.875 -0.375c-0.33335 0 -0.625 0.125 -0.875 0.375s-0.375 0.54165 -0.375 0.875c0 0.33335 0.125 0.625 0.375 0.875s0.54165 0.375 0.875 0.375ZM12 20.5c0.18335 0 0.3125 -0.0375 0.3875 -0.1125 0.075 -0.075 0.1125 -0.19585 0.1125 -0.3625 0 -0.23335 -0.12085 -0.45 -0.3625 -0.65 -0.24165 -0.2 -0.3625 -0.64165 -0.3625 -1.325 0 -0.76665 0.25 -1.44165 0.75 -2.025 0.5 -0.58335 1.13335 -0.875 1.9 -0.875h1.825c1.26665 0 2.29165 -0.37085 3.075 -1.1125S20.5 12.225 20.5 10.825c0 -2.2 -0.83335 -3.97085 -2.5 -5.3125C16.33335 4.170835 14.40835 3.5 12.225 3.5c-2.43335 0 -4.49585 0.820835 -6.1875 2.4625C4.345835 7.60415 3.5 9.61665 3.5 12c0 2.35 0.829165 4.35415 2.4875 6.0125C7.64585 19.67085 9.65 20.5 12 20.5Z" stroke-width="0.5"></path>
      </svg>
    </button>
    <div id="style2DGroup" class="collapse" aria-hidden="true">
      <div class="row center" style="flex-direction:column; gap:4px;">
        <label style="display:flex; flex-direction:column; align-items:center; gap:4px; font:12px/1.2 sans-serif; color:#333;">
          <span>Stroke</span>
          <input id="strokeColor" type="color" value="#111111" />
        </label>
        <label style="display:flex; flex-direction:column; align-items:center; gap:4px; font:12px/1.2 sans-serif; color:#333;">
          <span>Fill</span>
          <input id="fillColor" type="color" value="#cccccc" />
          <button id="fillNoneBtn" class="icon-btn" aria-pressed="true" title="No Fill" aria-label="No Fill">
            <svg viewBox="0 0 24 24" aria-hidden="true" width="18" height="18">
              <circle cx="12" cy="12" r="8" fill="#ccc" stroke="#222" stroke-width="2"/>
              <path d="M6 6l12 12" stroke="#222" stroke-width="2"/>
            </svg>
          </button>
        </label>
        <label for="thickness" style="font:12px/1.2 sans-serif; color:#333;">LPX</label>
        <input id="thickness" class="vslider" type="range" min="1" max="24" step="1" value="2" aria-label="Line thickness (px)" />
        <span id="thicknessVal" style="font:11px/1.2 system-ui, sans-serif; color:#444;">2 px</span>
      </div>
    </div>

    <!-- Erase parent -->
    <button id="toggle2DErase" class="icon-btn toggle-btn" title="Erase" aria-label="Erase" aria-pressed="false">
      <span class="sr-only">Erase</span>
      <svg id="Erase" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" height="16" width="16">
        <defs></defs>
        <title>erase</title>
        <path d="M3.5 13.5h11.5v1H3.5Z" fill="#000000" stroke-width="0.5"></path>
        <path d="m13.69 5.255 -3.965 -3.96a1 1 0 0 0 -1.415 0l-7 7a1 1 0 0 0 0 1.415L3.565 12h4.795l5.33 -5.33a1 1 0 0 0 0 -1.415ZM7.945 11H4l-2 -2 3.155 -3.155 3.965 3.96Zm1.88 -1.88 -3.96 -3.965L9 2l4 3.965Z" fill="#000000" stroke-width="0.5"></path>
        <path id="_Transparent_Rectangle_" d="M0 0h16v16H0Z" fill="none" stroke-width="0.5"></path>
      </svg>
    </button>
  <div id="erase2DGroup" class="collapse" aria-hidden="true">
  <div style="display:flex; flex-direction:column; align-items:center; gap:4px;">
        <!-- 1) Object Erase -->
        <button id="tEraseObj" class="icon-btn" aria-pressed="false" title="Erase Object (Shift+E)" aria-label="Erase Object">
          <svg viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" id="Object Erase" height="16" width="16">
            <path d="M14 14 6 14" stroke="#000000" stroke-width="1" stroke-linecap="round" stroke-linejoin="round"></path>
            <path d="m9.942799999999998 2.27614 3.2998666666666665 3.299833333333333c0.5206666666666666 0.5206999999999999 0.5206666666666666 1.3648933333333333 0 1.8856266666666666l-6.1617999999999995 6.161733333333332c-0.24113333333333334 0.2412 -0.56824 0.3766666666666666 -0.9092933333333333 0.3766666666666666 -0.34106 0 -0.6681466666666667 -0.13546666666666665 -0.9093066666666667 -0.3766666666666666l-3.333333333333333 -3.333333333333333c-0.5206999999999999 -0.5206666666666666 -0.5206999999999999 -1.3648666666666665 0 -1.8855999999999997L4.666666666666666 5.666666666666666l3.1666666666666665 3.1666666666666665c0.46026666666666666 0.46026666666666666 1.2064 0.46026666666666666 1.6666666666666665 0 0.46026666666666666 -0.46026666666666666 0.46026666666666666 -1.2064 0 -1.6666666666666665L6.333333333333333 4l1.7238666666666664 -1.7238599999999997c0.5206666666666666 -0.5206933333333332 1.3649333333333333 -0.5206933333333332 1.8855999999999997 0Z" fill="#000000" stroke="#000000" stroke-width="1" stroke-linecap="round" stroke-linejoin="round"></path>
          </svg>
        </button>
        <!-- 2) Pixel Erase -->
        <button id="tErasePix" class="icon-btn" aria-pressed="false" title="Erase Pixels (E)" aria-label="Erase Pixels">
          <svg viewBox="-0.5 -0.5 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" id="Pixel Erase" height="16" width="16">
            <path d="M14.303999999999998 14.114437500000001H5.5680625" stroke="#000000" stroke-linecap="round" stroke-linejoin="round" stroke-width="1"></path>
            <path d="M10.5831875 9.6656875 5.178125 4.260625" stroke="#000000" stroke-linecap="round" stroke-linejoin="round" stroke-width="1"></path>
            <path d="M1.1224375 8.0040625 7.8145 1.312c0.5685625 -0.5685625 1.4905 -0.5685625 2.0590625 0l3.6034375 3.6034375c0.5685625 0.5685625 0.5685625 1.4904375 0 2.0590625L6.748374999999999 13.703125c-0.263375 0.263375 -0.6205625 0.4113125 -0.993 0.4113125s-0.7295625 -0.1479375 -0.9929375 -0.4113125l-3.6399999999999997 -3.6399999999999997c-0.5685625 -0.5685625 -0.5685625 -1.4904375 0 -2.0590625Z" stroke="#000000" stroke-linecap="round" stroke-linejoin="round" stroke-width="1"></path>
          </svg>
        </button>
        <!-- 3) Pixel Brush Size -->
        <input id="eraserRadius" class="vslider" type="range" min="0.1" max="5" step="0.1" value="0.5" aria-label="Brush size" />
        <span id="eraserRadiusVal" style="font:11px/1.2 system-ui, sans-serif; color:#444;">0.50 ft</span>
      </div>
    </div>

    <!-- Save to Personal Columbarium (parent button) -->
    <button id="save2D" class="icon-btn" title="Save to Columbarium" aria-label="Save to Columbarium">
      <span class="sr-only">Save to Columbarium</span>
      <svg viewBox="0 0 24 24" aria-hidden="true">
        <!-- Personal columbarium: tic-tac-toe with black center + up arrow (matched to 3D) -->
        <g fill="none" stroke="#222" stroke-width="1.8">
          <path d="M8 3v18M16 3v18M3 8h18M3 16h18"/>
        </g>
        <!-- Filled black center square -->
        <rect x="8.9" y="8.9" width="6.2" height="6.2" fill="#222"/>
  <!-- Down arrow to denote save/download to Columbarium -->
  <path d="M22.3 3V15" stroke="#222" stroke-width="2" stroke-linecap="round"/>
  <path d="M22.3 21 L19 15 L24 15 Z" fill="#222"/>
      </svg>
    </button>

  <!-- Tools parent removed (panning is via middle/right/Space; selection is a top-level toggle) -->

    <!-- Utilities (was Edit/Export) -->
    <button id="toggle2DEdit" class="icon-btn toggle-btn" title="Utilities" aria-label="Utilities" aria-pressed="false">
      <span class="sr-only">Utilities</span>
      <svg viewBox="0 0 24 24" aria-hidden="true">
        <rect x="3" y="9" width="18" height="10" rx="2" ry="2" fill="none" stroke="#222" stroke-width="2"/>
        <rect x="8" y="6" width="8" height="3" rx="1.5" ry="1.5" fill="none" stroke="#222" stroke-width="2"/>
        <path d="M8 9V7m8 2V7" stroke="#222" stroke-width="2"/>
      </svg>
    </button>
    <div id="edit2DGroup" class="collapse" aria-hidden="true">
  <!-- Architectural scale selector removed from toolbox; scale is chosen during import flow -->
      <button id="undo" class="icon-btn" title="Undo (Ctrl/Cmd+Z)" aria-label="Undo">
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" id="Undo--Streamline-Rounded-Material" height="24" width="24">
          <path fill="#000000" d="M7.225 19c-0.2167 0 -0.39585 -0.07085 -0.5375 -0.2125 -0.1417 -0.14165 -0.2125 -0.32085 -0.2125 -0.5375 0 -0.21665 0.0708 -0.39585 0.2125 -0.5375 0.14165 -0.14165 0.3208 -0.2125 0.5375 -0.2125h7c1.16665 0 2.1708 -0.3875 3.0125 -1.1625C18.07915 15.5625 18.5 14.6 18.5 13.45c0 -1.15 -0.42085 -2.1125 -1.2625 -2.8875 -0.8417 -0.775 -1.84585 -1.1625 -3.0125 -1.1625H6.85l2.325 2.325c0.15 0.15 0.225 0.325 0.225 0.525s-0.075 0.375 -0.225 0.525c-0.15 0.15 -0.325 0.225 -0.525 0.225s-0.375 -0.075 -0.525 -0.225l-3.60001 -3.6c-0.083335 -0.08335 -0.14167 -0.16665 -0.175 -0.25 -0.033335 -0.08335 -0.05 -0.175 -0.05 -0.275 0 -0.1 0.016665 -0.19165 0.05 -0.275 0.03333 -0.08335 0.091665 -0.16665 0.175 -0.25L8.125 4.525c0.15 -0.15 0.325 -0.225 0.525 -0.225s0.375 0.075 0.525 0.225c0.15 0.15 0.225 0.325 0.225 0.525s-0.075 0.375 -0.225 0.525L6.85 7.9h7.35c1.5833 0 2.9458 0.53335 4.0875 1.6C19.42915 10.56665 20 11.88335 20 13.45s-0.57085 2.88335 -1.7125 3.95C17.1458 18.46665 15.7833 19 14.2 19H7.225Z" stroke-width="0.5"></path>
        </svg>
      </button>
      <button id="redo" class="icon-btn" title="Redo (Ctrl/Cmd+Shift+Z)" aria-label="Redo">
        <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" id="Redo--Streamline-Outlined-Material" height="24" width="24">
          <g id="redo">
            <path id="Vector" d="M9.8 19c-1.58335 0 -2.94585 -0.53335 -4.0875 -1.6C4.570835 16.33335 4 15.01665 4 13.45s0.570835 -2.88335 1.7125 -3.95c1.14165 -1.06665 2.50415 -1.6 4.0875 -1.6h7.35l-2.85 -2.85L15.35 4l4.65 4.65 -4.65 4.65 -1.05 -1.05 2.85 -2.85H9.775c-1.16665 0 -2.17085 0.3875 -3.0125 1.1625C5.92085 11.3375 5.5 12.3 5.5 13.45c0 1.15 0.42085 2.1125 1.2625 2.8875C7.60415 17.1125 8.60835 17.5 9.775 17.5h7.75v1.5H9.8Z" fill="#000000" stroke-width="0.5"></path>
          </g>
        </svg>
      </button>
      <button id="clear" class="icon-btn" title="Clear" aria-label="Clear">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="-0.5 -0.5 24 24" fill="none" stroke="#000000" stroke-linecap="round" stroke-linejoin="round" id="Trash-2--Streamline-Lucide" height="24" width="24">
          <path d="M2.875 5.75h17.25" stroke-width="1"></path>
          <path d="M18.208333333333336 5.75v13.416666666666668c0 0.9583333333333334 -0.9583333333333334 1.9166666666666667 -1.9166666666666667 1.9166666666666667H6.708333333333334c-0.9583333333333334 0 -1.9166666666666667 -0.9583333333333334 -1.9166666666666667 -1.9166666666666667V5.75" stroke-width="1"></path>
          <path d="M7.666666666666667 5.75V3.8333333333333335c0 -0.9583333333333334 0.9583333333333334 -1.9166666666666667 1.9166666666666667 -1.9166666666666667h3.8333333333333335c0.9583333333333334 0 1.9166666666666667 0.9583333333333334 1.9166666666666667 1.9166666666666667v1.9166666666666667" stroke-width="1"></path>
          <path d="m9.583333333333334 10.541666666666668 0 5.75" stroke-width="1"></path>
          <path d="m13.416666666666668 10.541666666666668 0 5.75" stroke-width="1"></path>
        </svg>
      </button>
      <!-- Import PDF (as underlay with scale) -->
      <button id="importPDF2D" class="icon-btn" title="Import PDF (underlay)" aria-label="Import PDF">
        <svg viewBox="0 0 24 24" aria-hidden="true">
          <!-- Unified import icon: box with DOWN arrow; filetype below -->
          <rect x="4" y="2" width="16" height="12" rx="2" fill="none" stroke="#222" stroke-width="1.6"/>
          <path d="M12 6v6" stroke="#222" stroke-width="2"/>
          <path d="M9 9l3 3 3-3" stroke="#222" stroke-width="2" fill="none"/>
          <text x="12" y="22" text-anchor="middle" font-size="9" fill="#222" font-family="Arial" font-weight="normal">PDF</text>
        </svg>
      </button>
  <!-- Import DXF (vector) -->
  <button id="importDXF2D" class="icon-btn" title="Import DXF (vector)" aria-label="Import DXF">
        <svg viewBox="0 0 24 24" aria-hidden="true">
          <!-- Unified import icon: box with DOWN arrow; filetype below -->
          <rect x="4" y="2" width="16" height="12" rx="2" fill="none" stroke="#222" stroke-width="1.6"/>
          <path d="M12 6v6" stroke="#222" stroke-width="2"/>
          <path d="M9 9l3 3 3-3" stroke="#222" stroke-width="2" fill="none"/>
          <text x="12" y="22" text-anchor="middle" font-size="9" fill="#222" font-family="Arial" font-weight="normal">DXF</text>
        </svg>
      </button>
      <button id="exportPNG" class="icon-btn" title="Export PNG" aria-label="Export PNG">
        <svg viewBox="0 0 24 24" aria-hidden="true">
          <!-- Unified export icon: box with UP arrow; filetype below -->
          <rect x="4" y="2" width="16" height="12" rx="2" fill="none" stroke="#222" stroke-width="1.6"/>
          <path d="M12 12V6" stroke="#222" stroke-width="2"/>
          <path d="M9 9l3-3 3 3" stroke="#222" stroke-width="2" fill="none"/>
          <text x="12" y="22" text-anchor="middle" font-size="9" fill="#222" font-family="Arial" font-weight="normal">PNG</text>
        </svg>
      </button>
      <button id="exportPDF" class="icon-btn" title="Export PDF" aria-label="Export PDF">
        <svg viewBox="0 0 24 24" aria-hidden="true">
          <!-- Unified export icon: box with UP arrow; filetype below -->
          <rect x="4" y="2" width="16" height="12" rx="2" fill="none" stroke="#222" stroke-width="1.6"/>
          <path d="M12 12V6" stroke="#222" stroke-width="2"/>
          <path d="M9 9l3-3 3 3" stroke="#222" stroke-width="2" fill="none"/>
          <text x="12" y="22" text-anchor="middle" font-size="9" fill="#222" font-family="Arial" font-weight="normal">PDF</text>
        </svg>
      </button>
    </div>
  </div>
  <!-- No-keyboard delete bar (appears below toolbox when selection exists) -->
  <div id="mobileDeleteBar" role="group" aria-label="Mobile actions">
    <button id="mobileDeleteBtn2D" class="icon-btn" title="Delete selected" aria-label="Delete selected" type="button">
      <span class="sr-only">Delete selected</span>
      <svg viewBox="0 0 24 24" aria-hidden="true">
        <g fill="none" stroke="#222" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="M4 7h16"/>
          <path d="M9 7V5a2 2 0 0 1 2-2h2a2 2 0 0 1 2 2v2"/>
          <rect x="6" y="7" width="12" height="13" rx="2"/>
          <path d="M10 11v6M14 11v6"/>
        </g>
      </svg>
    </button>
  </div>
  <div id="statusBar">Ready</div>
  
  <!-- Modify tool HUD: slides out next to toolbox for Offset/Fillet/Chamfer -->
  <div id="modifyHUD" aria-hidden="true">
    <button id="mhClose" class="mh-x" title="Close" aria-label="Close" type="button">×</button>
    <div class="mh-title" id="mhTitle">Modify</div>
    <div class="mh-row" id="mhJoinRow">
      <span class="mh-label">Join</span>
      <div class="mh-joins">
        <button id="mhJoinMiter" class="pill" aria-pressed="true">Miter</button>
        <button id="mhJoinRound" class="pill" aria-pressed="false">Round</button>
        <button id="mhJoinBevel" class="pill" aria-pressed="false">Bevel</button>
      </div>
    </div>
    <div class="mh-row" id="mhValueRow">
      <span class="mh-label" id="mhValueLabel">Distance</span>
      <div class="mh-stepper">
        <button id="mhDec" class="icon-btn small" title="Decrease" type="button">−</button>
        <input id="mhValue" type="number" step="0.25" min="0" value="1" />
        <button id="mhInc" class="icon-btn small" title="Increase" type="button">+</button>
        <span class="mh-unit">ft</span>
      </div>
    </div>
    <div class="mh-hint" id="mhHint">Shift to snap. J to cycle join. O for numeric.</div>
  </div>
  
  <!-- Import Scale Modal (used by PDF and DXF imports) -->
  <div id="importScaleModal" style="display:none; position:fixed; inset:0; z-index:200; background:rgba(0,0,0,0.5); align-items:center; justify-content:center;">
    <div style="background:#fff; color:#222; width:min(92vw, 840px); max-height:90vh; border-radius:12px; border:1px solid #ddd; box-shadow:0 12px 32px rgba(0,0,0,0.2); display:flex; flex-direction:column;">
      <div style="padding:10px 14px; border-bottom:1px solid #eee; font:600 14px system-ui, sans-serif;">Import Preview & Scale</div>
      <div id="importModalBody" style="display:flex; gap:12px; padding:12px; overflow:auto;">
        <div id="importPreviewContainer" style="flex:1; min-width:320px; display:flex; align-items:center; justify-content:center; background:#f7f7f7; border:1px solid #eee; border-radius:8px;">
          <canvas id="importPreview" width="720" height="480" style="max-width:100%; height:auto; display:block;"></canvas>
        </div>
        <div style="width:240px; display:flex; flex-direction:column; gap:10px;">
          <div id="importPDFPageWrap" style="display:none;">
            <label for="importPageNumber" style="display:block; font:12px/1.2 system-ui; color:#333; margin-bottom:4px;">Page</label>
            <div style="display:flex; align-items:center; gap:6px;">
              <button id="importPagePrev" class="icon-btn" title="Previous page" aria-label="Previous page" type="button" style="width:28px; height:28px; min-width:28px; min-height:28px;">
                <svg viewBox="0 0 24 24" aria-hidden="true" width="18" height="18"><path d="M15 6l-6 6 6 6" fill="none" stroke="#222" stroke-width="2"/></svg>
              </button>
              <input id="importPageNumber" type="number" min="1" value="1" style="width:64px; padding:6px 8px; font:13px system-ui; border:1px solid #ddd; border-radius:6px;" />
              <span style="font:12px/1.2 system-ui; color:#555;">of <span id="importPageTotal">1</span></span>
              <button id="importPageNext" class="icon-btn" title="Next page" aria-label="Next page" type="button" style="width:28px; height:28px; min-width:28px; min-height:28px;">
                <svg viewBox="0 0 24 24" aria-hidden="true" width="18" height="18"><path d="M9 6l6 6-6 6" fill="none" stroke="#222" stroke-width="2"/></svg>
              </button>
            </div>
          </div>
          <div id="importPDFThumbsWrap" style="display:none;">
            <label style="display:block; font:12px/1.2 system-ui; color:#333; margin:6px 0 4px;">Thumbnails</label>
            <div id="importPageThumbs" style="display:flex; gap:8px; overflow:auto; padding:6px; border:1px solid #eee; border-radius:8px; background:#fafafa; max-height:160px;"></div>
          </div>
          <div>
            <label for="importScalePreset" style="display:block; font:12px/1.2 system-ui; color:#333; margin-bottom:4px;">Architectural Scale</label>
            <select id="importScalePreset" style="width:100%; padding:6px 8px; font:13px system-ui; border:1px solid #ddd; border-radius:6px;">
              <option value="0.3333333333">3" = 1'-0"</option>
              <option value="0.6666666667">1-1/2" = 1'-0"</option>
              <option value="1">1" = 1'-0"</option>
              <option value="1.3333333333">3/4" = 1'-0"</option>
              <option value="2">1/2" = 1'-0"</option>
              <option value="2.6666666667">3/8" = 1'-0"</option>
              <option value="4" selected>1/4" = 1'-0"</option>
              <option value="5.3333333333">3/16" = 1'-0"</option>
              <option value="8">1/8" = 1'-0"</option>
              <option value="10.6666666667">3/32" = 1'-0"</option>
              <option value="16">1/16" = 1'-0"</option>
              <option value="0.0833333333">1:1 (inch = inch)</option>
            </select>
          </div>
          <div>
            <label for="importScaleCustom" style="display:block; font:12px/1.2 system-ui; color:#333; margin-bottom:4px;">Custom feet-per-inch</label>
            <input id="importScaleCustom" type="number" step="0.01" min="0.01" placeholder="e.g. 4 for 1/4\"=1'" style="width:100%; padding:6px 8px; font:13px system-ui; border:1px solid #ddd; border-radius:6px;" />
          </div>
          <div id="importDXFUnitsWrap" style="display:none;">
            <label for="importUnit" style="display:block; font:12px/1.2 system-ui; color:#333; margin-bottom:4px;">DXF Units</label>
            <select id="importUnit" style="width:100%; padding:6px 8px; font:13px system-ui; border:1px solid #ddd; border-radius:6px;">
              <option value="in">Inches</option>
              <option value="ft">Feet</option>
              <option value="mm">Millimeters</option>
              <option value="m">Meters</option>
            </select>
          </div>
          <div id="importOpacityWrap" style="display:none;">
            <label for="importOpacity" style="display:block; font:12px/1.2 system-ui; color:#333; margin-bottom:4px;">Underlay Opacity</label>
            <input id="importOpacity" type="range" min="0" max="1" step="0.01" value="0.85" />
          </div>
          <div style="margin-top:auto; display:flex; gap:8px; justify-content:flex-end;">
            <button id="importCancel" class="btn secondary" type="button" style="padding:6px 10px; border:1px solid #ddd; background:#f5f5f5; border-radius:6px;">Cancel</button>
            <button id="importConfirm" class="btn" type="button" style="padding:6px 10px; background:#111; color:#fff; border-radius:6px;">Import</button>
          </div>
        </div>
      </div>
    </div>
  </div>
  <!-- Floating 3D button to return to main scene -->
  <a id="to3D" class="floating-nav nav-top-right" href="./index.html" title="3D" aria-label="3D">
    <svg viewBox="0 0 24 24" aria-hidden="true">
      <g fill="none" stroke="#fff" stroke-width="1.8" opacity=".92">
        <path d="M4 8l8-4 8 4-8 4-8-4z"/>
        <path d="M4 8v8l8 4 8-4V8"/>
      </g>
    </svg>
  </a>
  <!-- Floating: Personal Columbarium -->
  <a id="toColumbariumFrom2D" class="floating-nav nav-top-right-2" href="./columbarium.html" title="Columbarium" aria-label="Columbarium">
    <svg viewBox="0 0 24 24" aria-hidden="true">
      <g fill="none" stroke="#fff" stroke-width="1.8" opacity=".92">
        <path d="M8 3v18M16 3v18M3 8h18M3 16h18"/>
      </g>
    </svg>
  </a>
  <!-- Floating: Push to AR (starts AR in 3D) -->
  <a id="toARFrom2D" class="floating-nav nav-top-right-3" href="./index.html?autoAR=1" title="Push to AR" aria-label="Push to AR">
    <svg viewBox="0 0 24 24" aria-hidden="true">
      <g fill="none" stroke="#fff" stroke-width="1.8" opacity=".92">
        <rect x="4" y="4" width="16" height="16" rx="3"/>
        <path d="M12 16V8M9 11l3-3 3 3"/>
      </g>
    </svg>
  </a>

  <script type="module" src="./js/app2d/app2d.js"></script>
</body>
</html>
