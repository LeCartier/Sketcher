<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
  <title>Sketcher â€“ Columbarium</title>
  <link rel="stylesheet" href="./css/styles.css" />
  <style>
    body { margin: 0; font-family: system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial, "Noto Sans", "Apple Color Emoji", "Segoe UI Emoji"; background:#111; color:#eee; }
  .btn { background:#1f6feb; color:#fff; border:none; padding:6px 10px; border-radius:4px; cursor:pointer; font-size:13px; }
  .btn.secondary { background:#333; color:#ddd; }
  .btn:disabled { opacity:0.6; cursor:not-allowed; }
  /* Pannable grid canvas */
  #gridStage { position: fixed; top:0; left:0; width:100vw; height:100vh; z-index: 0; display: block; cursor: grab; }
  #gridStage.grabbing { cursor: grabbing; }
  /* UI overlay for controls can stack above */
  .row { display:flex; gap:6px; }
    a.link { color:#9ecbff; text-decoration:none; }
    a.link:hover { text-decoration:underline; }
    /* Modal viewer */
    .modal-backdrop { position:fixed; inset:0; background:rgba(0,0,0,0.6); display:none; align-items:center; justify-content:center; z-index:99; }
    .modal { width:min(92vw, 960px); height:min(82vh, 640px); background:#111; border:1px solid #333; border-radius:8px; overflow:hidden; display:flex; flex-direction:column; }
    .modal header { border-bottom:1px solid #333; }
    .modal main { flex:1; position:relative; }
    .canvas-wrap { position:absolute; inset:0; }
    .modal footer { border-top:1px solid #333; padding:8px; display:flex; justify-content:flex-end; gap:8px; }
  </style>
  <script type="importmap">
    {
      "imports": {
        "three": "./js/vendor/three.module.js"
      }
    }
  </script>
</head>
<body>
  <!-- Toolbox-like controls for Columbarium (consistent with editor) -->
  <div id="cToolbox">
    <button id="cToggleImport" class="icon-btn toggle-btn" title="Import" aria-label="Import" aria-pressed="false">
      <span class="sr-only">Import</span>
      <svg viewBox="0 0 24 24" aria-hidden="true"><rect x="4" y="4" width="16" height="16" rx="2" fill="none" stroke="#222" stroke-width="2"/><path d="M12 8v6" stroke="#222" stroke-width="2"/><path d="M9 14l3 3 3-3" fill="none" stroke="#222" stroke-width="2"/></svg>
    </button>
    <div id="cImportGroup" class="collapse" aria-hidden="true" style="width:100%;">
      <button id="importBtn" class="icon-btn" title="Import Scene JSON" aria-label="Import Scene JSON">
        <span class="sr-only">Import Scene JSON</span>
        <svg viewBox="0 0 24 24" aria-hidden="true"><rect x="4" y="4" width="16" height="16" rx="2" fill="none" stroke="#222" stroke-width="2"/><path d="M12 8v6" stroke="#222" stroke-width="2"/><path d="M9 14l3 3 3-3" fill="none" stroke="#222" stroke-width="2"/></svg>
      </button>
  <input id="importInput" type="file" accept="application/json,.json,.gltf,.glb,.obj" style="display:none" />
    </div>
    <button id="cCenterView" class="icon-btn" title="Center View" aria-label="Center View">
      <span class="sr-only">Center View</span>
      <svg viewBox="0 0 24 24" aria-hidden="true"><circle cx="12" cy="12" r="7" fill="none" stroke="#222" stroke-width="2"/><circle cx="12" cy="12" r="2" fill="#222"/></svg>
    </button>
  </div>
  <canvas id="gridStage" aria-label="Columbarium Grid"></canvas>

  <div id="viewerBackdrop" class="modal-backdrop" role="dialog" aria-modal="true" aria-hidden="true">
    <div class="modal">
      <header>
        <h1 id="viewerTitle" style="font-size:16px; font-weight:600; margin:0;">Preview</h1>
      </header>
      <main>
        <div class="canvas-wrap"><canvas id="viewerCanvas"></canvas></div>
      </main>
      <footer>
        <button id="viewerClose" class="btn secondary">Close</button>
      </footer>
    </div>
  </div>

  <!-- Floating button back to editor - top-left for consistency -->
  <a id="toEditorFloating" class="floating-nav nav-top-right" href="./index.html" title="Back to Editor" aria-label="Back to Editor">
    <!-- Clean perspective grid icon -->
    <svg viewBox="0 0 24 24" aria-hidden="true">
      <g fill="none" stroke="#fff" stroke-linecap="round" stroke-linejoin="round">
        <!-- Outer trapezoid (grid boundary) -->
        <path d="M9 8 L15 8 L20 18 L4 18 Z" stroke-width="1.4" opacity=".95"/>
        <!-- Horizontal grid lines (foreshortened) -->
        <path d="M8 10 H16" stroke-width="1.2" opacity=".9"/>
        <path d="M7 12 H17" stroke-width="1.1" opacity=".85"/>
        <path d="M6 14 H18" stroke-width="1.05" opacity=".8"/>
        <path d="M5 16 H19" stroke-width="1" opacity=".75"/>
        <!-- Vertical convergence lines to top center -->
        <path d="M4 18 L9 8" stroke-width="1" opacity=".8"/>
        <path d="M8 18 L11 8" stroke-width="1" opacity=".8"/>
        <path d="M12 18 L12 8" stroke-width="1" opacity=".8"/>
        <path d="M16 18 L13 8" stroke-width="1" opacity=".8"/>
        <path d="M20 18 L15 8" stroke-width="1" opacity=".8"/>
      </g>
    </svg>
  </a>
  <script type="module">
    // Page fade-in/out
    document.addEventListener('DOMContentLoaded', () => {
      requestAnimationFrame(()=>document.body.classList.add('page-ready'));
  const hooks = [document.getElementById('toEditorFloating')].filter(Boolean);
      hooks.forEach(el => el.addEventListener('click', (e) => {
        e.preventDefault();
        const href = el.getAttribute('href');
        document.body.classList.add('page-leave');
        setTimeout(()=>{ window.location.href = href; }, 180);
      }));
    });
  // Load modules: preview/import wiring and interactive grid
  import('./js/app/columbarium.js');
  import('./js/app/columbarium-grid.js');
  // Toolbox behavior
  const cToggleImport = document.getElementById('cToggleImport');
  const cImportGroup = document.getElementById('cImportGroup');
  if (cToggleImport && cImportGroup) {
    cToggleImport.addEventListener('click', () => {
      const isOpen = cImportGroup.classList.contains('open');
      cImportGroup.classList.toggle('open', !isOpen);
      cImportGroup.setAttribute('aria-hidden', isOpen ? 'true' : 'false');
      cToggleImport.setAttribute('aria-pressed', isOpen ? 'false' : 'true');
    });
  }
  const cCenterView = document.getElementById('cCenterView');
  if (cCenterView) cCenterView.addEventListener('click', ()=> window.dispatchEvent(new CustomEvent('columbarium:center')));
  </script>
</body>
</html>
